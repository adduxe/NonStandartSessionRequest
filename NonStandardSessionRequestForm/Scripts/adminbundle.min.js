"use strict";var adminModule=angular.module("adminModule",["ngResource","kendo.directives"]);adminModule.controller("burQueueCtrl",["$scope","$filter","Submissions","RateTypes","CampusLocations",function(n,t,i,r,u){function f(n){for(var i="",t=0;t<u.length;++t)if(u[t].campusCode=n){i=u[t].campusName;break}return i}function e(n){for(var i="",t=0;t<r.length;++t)if(r[t].rateCode==n){i=r[t].rateName;break}return i}n.dataSource=new kendo.data.DataSource({transport:{read:function(r){i.query(function(i){n.submissions=i;r.success(i.map(function(n){return{requestId:n.requestId,submissionId:n.submissionId,academicTerm:n.session.academicTerm,sessionCode:n.session.sessionCode,sessionName:n.session.sessionName,userEmail:n.session.userEmail,userPhone:n.session.userPhone,uscCampusLocation:f(n.session.uscCampusLocation),otherCampusLocation:n.session.otherCampusLocation,lastDayForAddDrop:t("date")(n.session.lastDayForAddDrop,"mediumDate"),lastDayForWithdrawal:t("date")(n.session.lastDayForWithdrawal,"mediumDate"),lastDayForEnrollmentOptionChange:t("date")(n.session.lastDayForEnrollmentOptionChange,"mediumDate"),firstDayOfClass:t("date")(n.session.firstDayOfClass,"mediumDate"),lastDayOfClass:t("date")(n.session.lastDayOfClass,"mediumDate"),firstDayOfFinals:t("date")(n.session.firstDayOfFinals,"mediumDate"),lastDayOfFinals:t("date")(n.session.lastDayOfFinals,"mediumDate"),firstDayForFinalGrading:t("date")(n.session.firstDayForFinalGrading,"mediumDate"),lastDayForFinalGrading:t("date")(n.session.lastDayForFinalGrading,"mediumDate"),rateType:e(n.session.rateType),ratePerUnitAmount:n.session.ratePerUnitAmount,flatRateAmount:n.session.flatRateAmount,flatRateUnitsMin:n.session.flatRateUnitsMin,flatRateUnitsMax:n.session.flatRateUnitsMax,owningSchool:n.session.owningSchool,owningDepartment:n.session.owningDepartment,userContact:n.session.userContact,requestDate:t("date")(n.session.requestDate,"mediumDate"),sections:n.session.sections,sessionBreaks:n.session.sessionBreaks,comments:n.session.comments,faoAction:n.faoAction,faoActionDate:t("date")(n.faoActionDate,"mediumDate"),faoActionReason:n.faoActionReason,rnrAction:n.rnrAction,rnrActionDate:t("date")(n.rnrActionDate,"mediumDate"),rnrActionReason:n.rnrActionReason}}));n.spinningWheel.center().close()},function(t){alert("Cannot load submissions. "+t.data.message);n.spinningWheel.center().close()})}},schema:{model:{fields:{sessionCode:{type:"string"},sessionName:{type:"string"},owningSchool:{type:"string"},userContact:{type:"string"},requestDate:{type:"string"}}}},pageSize:10});n.mainGridOptions={dataSource:n.dataSource,sortable:!0,pageable:!0,columns:[{field:"requestId",title:"Request",width:"10%"},{field:"academicTerm",title:"Term",width:"10%"},{field:"sessionCode",title:"Session",width:"15%"},{field:"sessionName",title:"Session Name",width:"20%"},{field:"owningSchool",title:"School",width:"20%"},{field:"owningDepartment",title:"Department",width:"15%"},{field:"requestDate",title:"Date",width:"10%"},],editable:"popup"};n.sectionGridOptions=function(n){return{dataSource:{data:n.sections,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"sectionNumber",title:"Section",width:"10%"},{field:"prefix",title:"Prefix",width:"10%"},{field:"title",title:"Section Title",width:"15%"},{field:"courseNumber",title:"Course #",width:"10%"},{field:"unitValue",title:"Units",width:"10%"},{field:"estimatedEnrollment",title:"Class size",width:"10%"},{field:"instructorName",title:"Instructor",width:"15%"},{field:"incomeAmountNumber",title:"Acct. no.",width:"10%"}]}};n.scheduleGridOptions=function(n){return{dataSource:{data:n.schedules,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"classDayOfWeek",title:"Class Day",width:"100px"},{field:"classStartTime",title:"Start Time",width:"150px"},{field:"classEndTime",title:"End Time",width:"150px"}]}};n.sessionBrkGridOptions=function(n){return{dataSource:{data:n.sessionBreaks,pageSize:5,schema:{model:{fields:{startDate:{type:"date"},endDate:{type:"date"}}}}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"startDate",title:"Start Date",format:"{0:MMM dd, yyyy}"},{field:"endDate",title:"End Date",format:"{0:MMM dd, yyyy}"}]}};$(document).ready(function(){n.spinningWheel.center().open()})}]);adminModule.controller("faoQueueCtrl",["$scope","$filter","Submissions","RateTypes","EmailResult","CampusLocations",function(n,t,i,r,u,f){function e(n){for(var i="",t=0;t<f.length;++t)if(f[t].campusCode=n){i=f[t].campusName;break}return i}function o(n){for(var i="",t=0;t<r.length;++t)if(r[t].rateCode==n){i=r[t].rateName;break}return i}n.dataSource=new kendo.data.DataSource({transport:{read:function(r){i.query(function(i){n.submissions=i;r.success(i.map(function(n){return{requestId:n.requestId,submissionId:n.submissionId,academicTerm:n.session.academicTerm,sessionCode:n.session.sessionCode,sessionName:n.session.sessionName,userEmail:n.session.userEmail,userPhone:n.session.userPhone,isClassHeldAtUpc:n.session.isClassHeldAtUpc,uscCampusLocation:e(n.session.uscCampusLocation),otherCampusLocation:n.session.otherCampusLocation,lastDayForAddDrop:t("date")(n.session.lastDayForAddDrop,"mediumDate"),lastDayForWithdrawal:t("date")(n.session.lastDayForWithdrawal,"mediumDate"),lastDayForEnrollmentOptionChange:t("date")(n.session.lastDayForEnrollmentOptionChange,"mediumDate"),firstDayOfClass:t("date")(n.session.firstDayOfClass,"mediumDate"),lastDayOfClass:t("date")(n.session.lastDayOfClass,"mediumDate"),firstDayOfFinals:t("date")(n.session.firstDayOfFinals,"mediumDate"),lastDayOfFinals:t("date")(n.session.lastDayOfFinals,"mediumDate"),firstDayForFinalGrading:t("date")(n.session.firstDayForFinalGrading,"mediumDate"),lastDayForFinalGrading:t("date")(n.session.lastDayForFinalGrading,"mediumDate"),rateType:o(n.session.rateType),ratePerUnitAmount:n.session.ratePerUnitAmount,flatRateAmount:n.session.flatRateAmount,flatRateUnitsMin:n.session.flatRateUnitsMin,flatRateUnitsMax:n.session.flatRateUnitsMax,owningSchool:n.session.owningSchool,owningDepartment:n.session.owningDepartment,userContact:n.session.userContact,requestDate:t("date")(n.session.requestDate,"mediumDate"),sections:n.session.sections,sessionBreaks:n.session.sessionBreaks,comments:n.session.comments,faoAction:n.faoAction,faoActionDate:t("date")(n.faoActionDate,"mediumDate"),faoActionReason:n.faoActionReason,rnrAction:n.rnrAction,rnrActionDate:t("date")(n.rnrActionDate,"mediumDate"),rnrActionReason:n.rnrActionReason}}));n.spinningWheel.center().close()},function(t){alert("Cannot load submissions. "+t.data.message);n.spinningWheel.center().close()})}},schema:{model:{fields:{sessionCode:{type:"string"},sessionName:{type:"string"},owningSchool:{type:"string"},userContact:{type:"string"},requestDate:{type:"string"}}}},pageSize:10});n.mainGridOptions={dataSource:n.dataSource,sortable:!0,pageable:!0,columns:[{field:"requestId",title:"Request",width:"7.5%"},{field:"academicTerm",title:"Term",width:"7.5%"},{field:"sessionCode",title:"Session",width:"7.5%"},{field:"sessionName",title:"Session Name",width:"15%"},{field:"owningSchool",title:"School",width:"15%"},{field:"owningDepartment",title:"Department",width:"15%"},{field:"requestDate",title:"Date",width:"10%"},{template:"<button ng-click='approveRequest(#= data.submissionId #)'>Approve<\/button>"},{template:"<button ng-click='openRejectPopup(#= data.submissionId #)'>Reject<\/button>"}],editable:"popup"};n.sectionGridOptions=function(n){return{dataSource:{data:n.sections,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"sectionNumber",title:"Section",width:"10%"},{field:"prefix",title:"Prefix",width:"10%"},{field:"title",title:"Section Title",width:"15%"},{field:"courseNumber",title:"Course #",width:"10%"},{field:"unitValue",title:"Units",width:"10%"},{field:"estimatedEnrollment",title:"Class size",width:"10%"},{field:"instructorName",title:"Instructor",width:"15%"},{field:"incomeAmountNumber",title:"Acct. no.",width:"10%"}]}};n.scheduleGridOptions=function(n){return{dataSource:{data:n.schedules,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"classDayOfWeek",title:"Class Day",width:"100px"},{field:"classStartTime",title:"Start Time",width:"150px"},{field:"classEndTime",title:"End Time",width:"150px"}]}};n.sessionBrkGridOptions=function(n){return{dataSource:{data:n.sessionBreaks,pageSize:5,schema:{model:{fields:{startDate:{type:"date"},endDate:{type:"date"}}}}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"startDate",title:"Start Date",format:"{0: MMM dd, yyyy}"},{field:"endDate",title:"End Date",format:"{0: MMM dd, yyyy}"}]}};n.rejectSess={};n.openRejectPopup=function(t){n.submID=t;n.rejectWindow.center().open();return};n.approveRequest=function(t){n.submID=t;n.updateRequest("A","Approved");alert("Session Request Approved!");return};n.EmailUser=function(n){u.save({id:n});alert("Email sent for Submission ID: "+n);return};n.updateRequest=function(r,f){var e,o,s;if(!f){alert("Please provide a reason for rejecting the request.");return}e=t("filter")(n.submissions,{submissionId:n.submID},!0)[0];e!=null&&(n.rejectSess=e);o=new Date;s={submissionId:n.submID,faoAction:r,faoActionDate:o.toDateString(),faoActionReason:f,rnrAction:n.rejectSess.rnrAction,rnrActionDate:n.rejectSess.rnrActionDate,rnrActionReason:n.rejectSess.rnrActionReason};n.spinningWheel.center().open();i.update({submissionId:n.submID},s).$promise.then(function(){n.spinningWheel.center().close();switch(r){case"R":u.save({id:n.submID});alert("Rejection email sent.")}r=="R"&&n.rejectWindow.close();for(var t=0;t<n.dataSource._data.length;++t)if(n.dataSource._data[t].submissionId==n.submID){n.dataSource._data.splice(t,1);break}})};$(document).ready(function(){n.spinningWheel.center().open()})}]);adminModule.controller("rnrQueueCtrl",["$scope","$filter","Submissions","WriteToSis","EmailResult","RateTypes","CampusLocations",function(n,t,i,r,u,f,e){function s(n){for(var i="",t=0;t<e.length;++t)if(e[t].campusCode=n){i=e[t].campusName;break}return i}function h(n){for(var i="",t=0;t<f.length;++t)if(f[t].rateCode==n){i=f[t].rateName;break}return i}function o(n){var i="",t;return n&&(t=new Date(n),i=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),i}n.dataSource=new kendo.data.DataSource({transport:{read:function(r){i.query(function(i){n.submissions=i;r.success(i.map(function(n){return{submissionId:n.submissionId,requestId:n.requestId,academicTerm:n.session.academicTerm,sessionCode:n.session.sessionCode,sessionName:n.session.sessionName,userEmail:n.session.userEmail,userPhone:n.session.userPhone,uscCampusLocation:s(n.session.uscCampusLocation),otherCampusLocation:n.session.otherCampusLocation,lastDayForAddDrop:t("date")(n.session.lastDayForAddDrop,"mediumDate"),lastDayForWithdrawal:t("date")(n.session.lastDayForWithdrawal,"mediumDate"),lastDayForEnrollmentOptionChange:t("date")(n.session.lastDayForEnrollmentOptionChange,"mediumDate"),firstDayOfClass:t("date")(n.session.firstDayOfClass,"mediumDate"),lastDayOfClass:t("date")(n.session.lastDayOfClass,"mediumDate"),firstDayOfFinals:t("date")(n.session.firstDayOfFinals,"mediumDate"),lastDayOfFinals:t("date")(n.session.lastDayOfFinals,"mediumDate"),firstDayForFinalGrading:t("date")(n.session.firstDayForFinalGrading,"mediumDate"),lastDayForFinalGrading:t("date")(n.session.lastDayForFinalGrading,"mediumDate"),rateType:h(n.session.rateType),ratePerUnitAmount:n.session.ratePerUnitAmount,flatRateAmount:n.session.flatRateAmount,flatRateUnitsMin:n.session.flatRateUnitsMin,flatRateUnitsMax:n.session.flatRateUnitsMax,owningSchool:n.session.owningSchool,owningDepartment:n.session.owningDepartment,userContact:n.session.userContact,requestDate:t("date")(n.session.requestDate,"mediumDate"),sections:n.session.sections,sessionBreaks:n.session.sessionBreaks,comments:n.session.comments,faoAction:n.faoAction,faoActionDate:t("date")(n.faoActionDate,"mediumDate"),faoActionReason:n.faoActionReason,rnrAction:n.rnrAction,rnrActionDate:t("date")(n.rnrActionDate,"mediumDate"),rnrActionReason:n.rnrActionReason}}));n.spinningWheel.center().close()},function(t){alert("Cannot load submissions. "+t.data.message);n.spinningWheel.center().close()})}},schema:{model:{fields:{sessionCode:{type:"string"},sessionName:{type:"string"},owningSchool:{type:"string"},userContact:{type:"string"},requestDate:{type:"string"}}}},pageSize:10});n.mainGridOptions={dataSource:n.dataSource,sortable:!0,pageable:!0,columns:[{field:"requestId",title:"Request",width:"7.5%"},{field:"academicTerm",title:"Term",width:"7.5%"},{field:"sessionCode",title:"Session",width:"7.5%"},{field:"sessionName",title:"Session Name",width:"15%"},{field:"owningSchool",title:"School",width:"15%"},{field:"owningDepartment",title:"Department",width:"15%"},{field:"requestDate",title:"Date",width:"10%"},{template:"<button ng-click='approveRequest(#= data.submissionId #)'>Approve<\/button>"},{template:"<button ng-click='openRejectPopup(#= data.submissionId #)'>Reject<\/button>"}],editable:"popup"};n.sectionGridOptions=function(n){return{dataSource:{data:n.sections,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"sectionNumber",title:"Section",width:"10%"},{field:"prefix",title:"Prefix",width:"10%"},{field:"title",title:"Section Title",width:"15%"},{field:"courseNumber",title:"Course #",width:"10%"},{field:"unitValue",title:"Units",width:"10%"},{field:"estimatedEnrollment",title:"Class size",width:"10%"},{field:"instructorName",title:"Instructor",width:"15%"},{field:"incomeAmountNumber",title:"Acct. no.",width:"10%"}]}};n.scheduleGridOptions=function(n){return{dataSource:{data:n.schedules,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"classDayOfWeek",title:"Class Day",width:"100px"},{field:"classStartTime",title:"Start Time",width:"150px"},{field:"classEndTime",title:"End Time",width:"150px"}]}};n.sessionBrkGridOptions=function(n){return{dataSource:{data:n.sessionBreaks,pageSize:5,schema:{model:{fields:{startDate:{type:"date"},endDate:{type:"date"}}}}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"startDate",title:"Start Date",format:"{0:MMM dd, yyyy}"},{field:"endDate",title:"End Date",format:"{0:MMM dd, yyyy}"}]}};n.rejectSess={};n.openRejectPopup=function(i){n.submID=i;n.rejectWindow.center().open();n.selectedSess=t("filter")(n.submissions,{submissionId:n.submID},!0)[0];return};n.approveRequest=function(i){var s;n.submID=i;n.selectedSess=t("filter")(n.submissions,{submissionId:n.submID},!0)[0];var u=n.selectedSess.session,f={Sess1Start:0,Sess1End:1,Sess2Start:2,Sess2End:3},e=["","","",""];switch(u.sessionBreaks.length){case 2:e[f.Sess2Start]=u.sessionBreaks[1].startDate;e[f.Sess2End]=u.sessionBreaks[1].endDate;case 1:e[f.Sess1Start]=u.sessionBreaks[0].startDate;e[f.Sess1End]=u.sessionBreaks[0].endDate}s={academicTerm:u.academicTerm,sessionCode:u.sessionCode,firstDayOfClass:o(u.firstDayOfClass),lastDayOfClass:o(u.lastDayOfClass),firstDayOfFinals:o(u.firstDayOfFinals),lastDayOfFinals:o(u.lastDayOfFinals),lastDayForAddDrop:o(u.lastDayForAddDrop),lastDayForWithdrawal:o(u.lastDayForWithdrawal),lastDayForEnrollmentOptionChange:o(u.lastDayForEnrollmentOptionChange),firstDayForFinalGrading:o(u.firstDayForFinalGrading),lastDayForFinalGrading:o(u.lastDayForFinalGrading),sessionBreak1BeginDate:o(e[f.Sess1Start]),sessionBreak1EndDate:o(e[f.Sess1End]),sessionBreak2BeginDate:o(e[f.Sess2Start]),sessionBreak2EndDate:o(e[f.Sess2End])};r.save(s,function(){n.updateRequest("A","Approved");alert("Session Request Approved!")},function(){alert("Failed to write the approved session "+s.academicTerm+"-"+s.sessionCode+" because it already exists in SIS.")});return};n.updateRequest=function(t,r){if(!r){alert("Please provide a reason for rejecting the request.");return}var f=new Date,e={submissionId:n.submID,faoAction:n.selectedSess.faoAction,faoActionDate:n.selectedSess.faoActionDate,faoActionReason:n.selectedSess.faoActionReason,rnrAction:t,rnrActionDate:f.toDateString(),rnrActionReason:r};n.spinningWheel.center().open();i.update({submissionId:n.submID},e).$promise.then(function(){n.spinningWheel.center().close();switch(t){case"A":u.save({id:n.submID});alert("Approval email sent");break;case"R":u.save({id:n.submID});alert("Rejection email sent")}for(var i=0;i<n.dataSource._data.length;++i)if(n.dataSource._data[i].submissionId==n.submID){n.dataSource._data.splice(i,1);break}t=="R"&&n.rejectWindow.close()})};$(document).ready(function(){n.spinningWheel.center().open()})}]);adminModule.factory("CampusLocations",["$resource",function(){return[{campusCode:"HSC",campusName:"Health Science Campus"},{campusCode:"OCC",campusName:"Orange County Campus"},{campusCode:"OVS",campusName:"Overseas"},{campusCode:"DC",campusName:"Washington D.C."},{campusCode:"SAC",campusName:"Sacramento"},{campusCode:"USA",campusName:"Off-campus in U.S."},{campusCode:"VIR",campusName:"Virtual(DEN/Online)"},{campusCode:"CAT",campusName:"Catalina"},{campusCode:"LAC",campusName:"L.A. Center"},{campusCode:"SD",campusName:"San Diego"},{campusCode:"ATT",campusName:"AT&T Center"},{campusCode:"SKB",campusName:"No Tuition or Fees"},{campusCode:"OTH",campusName:"Others"}]}]);adminModule.factory("EmailResult",["$resource",function(n){return n("api/email/:requestId",{requestId:"@id"})}]);adminModule.factory("RateTypes",["$resource",function(){return[{rateCode:"STD",rateName:"Standard (session 001)"},{rateCode:"GBUS",rateName:"Graduate Business"},{rateCode:"GCINA",rateName:"Graduate Cinematic Arts"},{rateCode:"GENGR",rateName:"Graduate Engineering"},{rateCode:"MRED",rateName:"Master of Real Estate Development"},{rateCode:"PHAR",rateName:"Pharmacy"},{rateCode:"DENT",rateName:"Dentistry"},{rateCode:"DH",rateName:"Dental Hygiene"},{rateCode:"ADVDE",rateName:"Advanced Dentistry"},{rateCode:"LAW",rateName:"Law"},{rateCode:"MED",rateName:"Medicine"},{rateCode:"OTH",rateName:"Other"}]}]);adminModule.factory("Submissions",["$resource",function(n){return n("api/submissions/:submissionId",{submissionId:"@id"},{update:{method:"PUT"}})}]);adminModule.factory("WriteToSis",["$resource",function(n){return n("api/rnrswebsess",null,null)}]);