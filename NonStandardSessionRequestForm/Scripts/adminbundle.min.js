"use strict";function GetCampusLocations(){return[{campusCode:"HSC",campusName:"Health Science Campus"},{campusCode:"OCC",campusName:"Orange County Campus"},{campusCode:"OVS",campusName:"Overseas"},{campusCode:"DC",campusName:"Washington D.C."},{campusCode:"SAC",campusName:"Sacramento"},{campusCode:"USA",campusName:"Off-campus in U.S."},{campusCode:"VIR",campusName:"Virtual(DEN/Online)"},{campusCode:"CAT",campusName:"Catalina"},{campusCode:"LAC",campusName:"L.A. Center"},{campusCode:"SD",campusName:"San Diego"},{campusCode:"ATT",campusName:"AT&T Center"},{campusCode:"SKB",campusName:"No Tuition or Fees"},{campusCode:"OTH",campusName:"Others"}]}function GetCampusName(n,t){for(var r="",i=0;i<t.length;++i)if(t[i].campusCode==n){r=t[i].campusName;break}return r}var adminModule=angular.module("adminModule",["ngResource","kendo.directives"]),sessionModule=angular.module("sessionModule",["ngResource","ngRoute","kendo.directives"]);sessionModule.config(["$routeProvider","$locationProvider",function(n,t){n.when("/",{templateUrl:"scripts/app/views/SessionRequest.html",controller:"sessionRequestCtrl"}).when("/Result",{templateUrl:"scripts/app/views/SessionResult.html",controller:"sessionResultCtrl"}).otherwise({redirectTo:"/"});t.html5Mode(!0)}]);adminModule.factory("EmailResult",["$resource",function(n){return n("api/email/:requestId",{requestId:"@id"})}]);adminModule.factory("RateDescription",[function(){function n(n,t){var i=t.find(function(t){return t.term==n});return i!=undefined?i.rateTypes.map(function(n){return{rateCode:n.rateTypeCode,rateName:n.rateTypeDesc}}):[]}return function(t,i,r){var f=n(i,r),e,u;for(f.push({rateCode:"OTH",rateName:"Other"}),e="",u=0;u<f.length;++u)if(f[u].rateCode==t){e=f[u].rateName;break}return e}}]);adminModule.factory("Submissions",["$resource",function(n){return n("api/submissions/:submissionId",{submissionId:"@id"},{update:{method:"PUT"}})}]);adminModule.factory("WriteToSis",["$resource",function(n){return n("api/rnrswebsess",null,null)}]);adminModule.factory("CampusLocations",["$resource",function(){return GetCampusLocations()}]);sessionModule.factory("CampusLocations",["$resource",function(){return GetCampusLocations()}]);adminModule.factory("GetCampusName",["CampusLocations",function(n){return function(t){return GetCampusName(t,n)}}]);sessionModule.factory("GetCampusName",["CampusLocations",function(n){return function(t){return GetCampusName(t,n)}}]);adminModule.factory("RateTable",["$resource",function(n){return n("api/ratetable")}]);sessionModule.factory("RateTable",["$resource",function(n){return n("api/ratetable")}]);adminModule.controller("burQueueCtrl",["$scope","$filter","Submissions","RateTable","RateDescription","GetCampusName",function(n,t,i,r,u,f){function e(n){var i=Math.round(n),t="";switch(i%3){case 1:t="Not reviewed";break;case 2:t="Needs follow-up";break;default:t="Tuition Entered"}return t}n.dataSource=new kendo.data.DataSource({transport:{read:function(r){i.query(function(i){n.submissions=i;r.success(i.map(function(i){return{requestId:i.requestId,submissionId:i.submissionId,academicTerm:i.session.academicTerm,sessionCode:i.session.sessionCode,sessionName:i.session.sessionName,userEmail:i.session.userEmail,userPhone:i.session.userPhone,isClassHeldAtUpc:i.session.isClassHeldAtUpc,uscCampusLocation:f(i.session.uscCampusLocation),otherCampusLocation:i.session.otherCampusLocation,lastDayForAddDrop:t("date")(i.session.lastDayForAddDrop,"mediumDate"),lastDayForWithdrawal:t("date")(i.session.lastDayForWithdrawal,"mediumDate"),lastDayForEnrollmentOptionChange:t("date")(i.session.lastDayForEnrollmentOptionChange,"mediumDate"),firstDayOfClass:t("date")(i.session.firstDayOfClass,"mediumDate"),lastDayOfClass:t("date")(i.session.lastDayOfClass,"mediumDate"),firstDayOfFinals:t("date")(i.session.firstDayOfFinals,"mediumDate"),lastDayOfFinals:t("date")(i.session.lastDayOfFinals,"mediumDate"),firstDayForFinalGrading:t("date")(i.session.firstDayForFinalGrading,"mediumDate"),lastDayForFinalGrading:t("date")(i.session.lastDayForFinalGrading,"mediumDate"),rateType:u(i.session.rateType,i.session.academicTerm,n.rates),ratePerUnitAmount:i.session.ratePerUnitAmount,flatRateAmount:i.session.flatRateAmount,flatRateUnitsMin:i.session.flatRateUnitsMin,flatRateUnitsMax:i.session.flatRateUnitsMax,owningSchool:i.session.owningSchool,owningDepartment:i.session.owningDepartment,userContact:i.session.userContact,requestDate:t("date")(i.session.requestDate,"mediumDate"),sections:i.session.sections,sessionBreaks:i.session.sessionBreaks,comments:i.session.comments,faoAction:i.faoAction,faoActionDate:t("date")(i.faoActionDate,"mediumDate"),faoActionReason:i.faoActionReason,rnrAction:i.rnrAction,rnrActionDate:t("date")(i.rnrActionDate,"mediumDate"),rnrActionReason:i.rnrActionReason,burStatus:e(Math.random()*10)}}));n.spinningWheel.center().close()},function(t){alert("Cannot load submissions. "+t.data.message);n.spinningWheel.center().close()})}},schema:{model:{fields:{sessionCode:{type:"string"},sessionName:{type:"string"},owningSchool:{type:"string"},userContact:{type:"string"},requestDate:{type:"string"}}}},pageSize:10});n.mainGridOptions={dataSource:n.dataSource,sortable:!0,pageable:!0,columns:[{field:"burStatus",title:"Status",width:"12.5%"},{field:"requestId",title:"Request",width:"7.5%"},{field:"academicTerm",title:"Term",width:"7.5%"},{field:"sessionCode",title:"Session",width:"7.5%"},{field:"sessionName",title:"Session Name",width:"15%"},{field:"owningSchool",title:"School",width:"20%"},{field:"owningDepartment",title:"Department",width:"15%"},{field:"requestDate",title:"Date",width:"10%"},],editable:"popup"};n.sectionGridOptions=function(n){return{dataSource:{data:n.sections,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"sectionNumber",title:"Section",width:"10%"},{field:"prefix",title:"Prefix",width:"10%"},{field:"title",title:"Section Title",width:"15%"},{field:"courseNumber",title:"Course #",width:"10%"},{field:"unitValue",title:"Units",width:"10%"},{field:"estimatedEnrollment",title:"Class size",width:"10%"},{field:"instructorName",title:"Instructor",width:"15%"},{field:"incomeAmountNumber",title:"Acct. no.",width:"10%"}]}};n.scheduleGridOptions=function(n){return{dataSource:{data:n.schedules,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"classDayOfWeek",title:"Class Day",width:"100px"},{field:"classStartTime",title:"Start Time",width:"150px"},{field:"classEndTime",title:"End Time",width:"150px"}]}};n.sessionBrkGridOptions=function(n){return{dataSource:{data:n.sessionBreaks,pageSize:5,schema:{model:{fields:{startDate:{type:"date"},endDate:{type:"date"}}}}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"startDate",title:"Start Date",format:"{0:MMM dd, yyyy}"},{field:"endDate",title:"End Date",format:"{0:MMM dd, yyyy}"}]}};n.ChangeBurStatus=function(r){var u=t("filter")(n.submissions,{submissionId:r},!0)[0],e,f;u!=null&&(n.rejectSess=u);e=new Date;f={submissionId:r,faoAction:n.rejectSess.faoAction,faoActionDate:n.rejectSess.faoActionDate,faoActionReason:n.rejectSess.faoActionReason,rnrAction:n.rejectSess.rnrAction,rnrActionDate:n.rejectSess.rnrActionDate,rnrActionReason:n.rejectSess.rnrActionReason};n.spinningWheel.center().open();i.update({submissionId:r},f).$promise.then(function(){n.spinningWheel.center().close()}),function(){alert("Failed in updating the Bursar Status for Request ID: "+n.rejectSess.requestId);n.spinningWheel.center().close()};return};$(document).ready(function(){n.spinningWheel.center().open();n.rates=r.query()})}]);adminModule.controller("faoQueueCtrl",["$scope","$filter","Submissions","RateTable","RateDescription","EmailResult","GetCampusName",function(n,t,i,r,u,f,e){n.dataSource=new kendo.data.DataSource({transport:{read:function(r){i.query(function(i){n.submissions=i;r.success(i.map(function(i){return{requestId:i.requestId,submissionId:i.submissionId,academicTerm:i.session.academicTerm,sessionCode:i.session.sessionCode,sessionName:i.session.sessionName,userEmail:i.session.userEmail,userPhone:i.session.userPhone,isClassHeldAtUpc:i.session.isClassHeldAtUpc,uscCampusLocation:e(i.session.uscCampusLocation),otherCampusLocation:i.session.otherCampusLocation,lastDayForAddDrop:t("date")(i.session.lastDayForAddDrop,"mediumDate"),lastDayForWithdrawal:t("date")(i.session.lastDayForWithdrawal,"mediumDate"),lastDayForEnrollmentOptionChange:t("date")(i.session.lastDayForEnrollmentOptionChange,"mediumDate"),firstDayOfClass:t("date")(i.session.firstDayOfClass,"mediumDate"),lastDayOfClass:t("date")(i.session.lastDayOfClass,"mediumDate"),firstDayOfFinals:t("date")(i.session.firstDayOfFinals,"mediumDate"),lastDayOfFinals:t("date")(i.session.lastDayOfFinals,"mediumDate"),firstDayForFinalGrading:t("date")(i.session.firstDayForFinalGrading,"mediumDate"),lastDayForFinalGrading:t("date")(i.session.lastDayForFinalGrading,"mediumDate"),rateType:u(i.session.rateType,i.session.academicTerm,n.rates),ratePerUnitAmount:i.session.ratePerUnitAmount,flatRateAmount:i.session.flatRateAmount,flatRateUnitsMin:i.session.flatRateUnitsMin,flatRateUnitsMax:i.session.flatRateUnitsMax,owningSchool:i.session.owningSchool,owningDepartment:i.session.owningDepartment,userContact:i.session.userContact,requestDate:t("date")(i.session.requestDate,"mediumDate"),sections:i.session.sections,sessionBreaks:i.session.sessionBreaks,comments:i.session.comments,faoAction:i.faoAction,faoActionDate:t("date")(i.faoActionDate,"mediumDate"),faoActionReason:i.faoActionReason,rnrAction:i.rnrAction,rnrActionDate:t("date")(i.rnrActionDate,"mediumDate"),rnrActionReason:i.rnrActionReason}}));n.spinningWheel.center().close()},function(t){alert("Cannot load submissions. "+t.data.message);n.spinningWheel.center().close()})}},schema:{model:{fields:{sessionCode:{type:"string"},sessionName:{type:"string"},owningSchool:{type:"string"},userContact:{type:"string"},requestDate:{type:"string"}}}},pageSize:10});n.mainGridOptions={dataSource:n.dataSource,sortable:!0,pageable:!0,columns:[{field:"requestId",title:"Request",width:"7.5%"},{field:"academicTerm",title:"Term",width:"7.5%"},{field:"sessionCode",title:"Session",width:"7.5%"},{field:"sessionName",title:"Session Name",width:"15%"},{field:"owningSchool",title:"School",width:"15%"},{field:"owningDepartment",title:"Department",width:"15%"},{field:"requestDate",title:"Date",width:"10%"},{template:"<button ng-click='approveRequest(#= data.submissionId #)'>Approve<\/button>"},{template:"<button ng-click='openRejectPopup(#= data.submissionId #)'>Reject<\/button>"}],editable:"popup"};n.sectionGridOptions=function(n){return{dataSource:{data:n.sections,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"sectionNumber",title:"Section",width:"10%"},{field:"prefix",title:"Prefix",width:"10%"},{field:"title",title:"Section Title",width:"15%"},{field:"courseNumber",title:"Course #",width:"10%"},{field:"unitValue",title:"Units",width:"10%"},{field:"estimatedEnrollment",title:"Class size",width:"10%"},{field:"instructorName",title:"Instructor",width:"15%"},{field:"incomeAmountNumber",title:"Acct. no.",width:"10%"}]}};n.scheduleGridOptions=function(n){return{dataSource:{data:n.schedules,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"classDayOfWeek",title:"Class Day",width:"100px"},{field:"classStartTime",title:"Start Time",width:"150px"},{field:"classEndTime",title:"End Time",width:"150px"}]}};n.sessionBrkGridOptions=function(n){return{dataSource:{data:n.sessionBreaks,pageSize:5,schema:{model:{fields:{startDate:{type:"date"},endDate:{type:"date"}}}}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"startDate",title:"Start Date",format:"{0: MMM dd, yyyy}"},{field:"endDate",title:"End Date",format:"{0: MMM dd, yyyy}"}]}};n.rejectSess={};n.openRejectPopup=function(t){n.submID=t;n.rejectWindow.center().open();return};n.approveRequest=function(t){n.submID=t;n.updateRequest("A","Approved");alert("Session Request Approved!");return};n.EmailUser=function(n){f.save({id:n});alert("Email sent for Submission ID: "+n);return};n.updateRequest=function(r,u){var e,o,s;if(!u){alert("Please provide a reason for rejecting the request.");return}e=t("filter")(n.submissions,{submissionId:n.submID},!0)[0];e!=null&&(n.rejectSess=e);o=new Date;s={submissionId:n.submID,faoAction:r,faoActionDate:o.toDateString(),faoActionReason:u,rnrAction:n.rejectSess.rnrAction,rnrActionDate:n.rejectSess.rnrActionDate,rnrActionReason:n.rejectSess.rnrActionReason};n.spinningWheel.center().open();i.update({submissionId:n.submID},s).$promise.then(function(){n.spinningWheel.center().close();switch(r){case"R":f.save({id:n.submID});alert("Rejection email sent.")}r=="R"&&n.rejectWindow.close();for(var t=0;t<n.dataSource._data.length;++t)if(n.dataSource._data[t].submissionId==n.submID){n.dataSource._data.splice(t,1);break}})};$(document).ready(function(){n.spinningWheel.center().open();n.rates=r.query()})}]);adminModule.controller("rnrQueueCtrl",["$scope","$filter","Submissions","WriteToSis","EmailResult","RateTable","RateDescription","GetCampusName",function(n,t,i,r,u,f,e,o){function s(n){var i="",t;return n&&(t=new Date(n),i=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),i}function h(t){n.spinningWheel.center().close();switch(t){case"A":u.save({id:n.submID});alert("Approval email sent");break;case"R":u.save({id:n.submID});alert("Rejection email sent")}for(var i=0;i<n.dataSource._data.length;++i)if(n.dataSource._data[i].submissionId==n.submID){n.dataSource._data.splice(i,1);break}actionCode=="R"&&n.rejectWindow.close();return}n.dataSource=new kendo.data.DataSource({transport:{read:function(r){i.query(function(i){n.submissions=i;r.success(i.map(function(i){return{requestId:i.requestId,submissionId:i.submissionId,academicTerm:i.session.academicTerm,sessionCode:i.session.sessionCode,sessionName:i.session.sessionName,userEmail:i.session.userEmail,userPhone:i.session.userPhone,isClassHeldAtUpc:i.session.isClassHeldAtUpc,uscCampusLocation:o(i.session.uscCampusLocation),otherCampusLocation:i.session.otherCampusLocation,lastDayForAddDrop:t("date")(i.session.lastDayForAddDrop,"mediumDate"),lastDayForWithdrawal:t("date")(i.session.lastDayForWithdrawal,"mediumDate"),lastDayForEnrollmentOptionChange:t("date")(i.session.lastDayForEnrollmentOptionChange,"mediumDate"),firstDayOfClass:t("date")(i.session.firstDayOfClass,"mediumDate"),lastDayOfClass:t("date")(i.session.lastDayOfClass,"mediumDate"),firstDayOfFinals:t("date")(i.session.firstDayOfFinals,"mediumDate"),lastDayOfFinals:t("date")(i.session.lastDayOfFinals,"mediumDate"),firstDayForFinalGrading:t("date")(i.session.firstDayForFinalGrading,"mediumDate"),lastDayForFinalGrading:t("date")(i.session.lastDayForFinalGrading,"mediumDate"),rateType:e(i.session.rateType,i.session.academicTerm,n.rates),ratePerUnitAmount:i.session.ratePerUnitAmount,flatRateAmount:i.session.flatRateAmount,flatRateUnitsMin:i.session.flatRateUnitsMin,flatRateUnitsMax:i.session.flatRateUnitsMax,owningSchool:i.session.owningSchool,owningDepartment:i.session.owningDepartment,userContact:i.session.userContact,requestDate:t("date")(i.session.requestDate,"mediumDate"),sections:i.session.sections,sessionBreaks:i.session.sessionBreaks,comments:i.session.comments,faoAction:i.faoAction,faoActionDate:t("date")(i.faoActionDate,"mediumDate"),faoActionReason:i.faoActionReason,rnrAction:i.rnrAction,rnrActionDate:t("date")(i.rnrActionDate,"mediumDate"),rnrActionReason:i.rnrActionReason}}));n.spinningWheel.center().close()},function(t){alert("Cannot load submissions. "+t.data.message);n.spinningWheel.center().close()})}},schema:{model:{fields:{sessionCode:{type:"string"},sessionName:{type:"string"},owningSchool:{type:"string"},userContact:{type:"string"},requestDate:{type:"string"}}}},pageSize:10});n.mainGridOptions={dataSource:n.dataSource,sortable:!0,pageable:!0,columns:[{field:"requestId",title:"Request",width:"7.5%"},{field:"academicTerm",title:"Term",width:"7.5%"},{field:"sessionCode",title:"Session",width:"7.5%"},{field:"sessionName",title:"Session Name",width:"15%"},{field:"owningSchool",title:"School",width:"15%"},{field:"owningDepartment",title:"Department",width:"15%"},{field:"requestDate",title:"Date",width:"10%"},{template:"<button ng-click='approveRequest(#= data.submissionId #)'>Approve<\/button>"},{template:"<button ng-click='openRejectPopup(#= data.submissionId #)'>Reject<\/button>"}],editable:"popup"};n.sectionGridOptions=function(n){return{dataSource:{data:n.sections,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"sectionNumber",title:"Section",width:"10%"},{field:"prefix",title:"Prefix",width:"10%"},{field:"title",title:"Section Title",width:"15%"},{field:"courseNumber",title:"Course #",width:"10%"},{field:"unitValue",title:"Units",width:"10%"},{field:"estimatedEnrollment",title:"Class size",width:"10%"},{field:"instructorName",title:"Instructor",width:"15%"},{field:"incomeAmountNumber",title:"Acct. no.",width:"10%"}]}};n.scheduleGridOptions=function(n){return{dataSource:{data:n.schedules,pageSize:5},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"classDayOfWeek",title:"Class Day",width:"100px"},{field:"classStartTime",title:"Start Time",width:"150px"},{field:"classEndTime",title:"End Time",width:"150px"}]}};n.sessionBrkGridOptions=function(n){return{dataSource:{data:n.sessionBreaks,pageSize:5,schema:{model:{fields:{startDate:{type:"date"},endDate:{type:"date"}}}}},scrollable:!1,sortable:!0,pageable:!0,columns:[{field:"startDate",title:"Start Date",format:"{0:MMM dd, yyyy}"},{field:"endDate",title:"End Date",format:"{0:MMM dd, yyyy}"}]}};n.rejectSess={};n.openRejectPopup=function(i){n.submID=i;n.rejectWindow.center().open();n.selectedSess=t("filter")(n.submissions,{submissionId:n.submID},!0)[0];return};n.approveRequest=function(i){var o;n.submID=i;n.selectedSess=t("filter")(n.submissions,{submissionId:n.submID},!0)[0];var u=n.selectedSess.session,f={Sess1Start:0,Sess1End:1,Sess2Start:2,Sess2End:3},e=["","","",""];switch(u.sessionBreaks.length){case 2:e[f.Sess2Start]=u.sessionBreaks[1].startDate;e[f.Sess2End]=u.sessionBreaks[1].endDate;case 1:e[f.Sess1Start]=u.sessionBreaks[0].startDate;e[f.Sess1End]=u.sessionBreaks[0].endDate}o={academicTerm:u.academicTerm,sessionCode:u.sessionCode,firstDayOfClass:s(u.firstDayOfClass),lastDayOfClass:s(u.lastDayOfClass),firstDayOfFinals:s(u.firstDayOfFinals),lastDayOfFinals:s(u.lastDayOfFinals),lastDayForAddDrop:s(u.lastDayForAddDrop),lastDayForWithdrawal:s(u.lastDayForWithdrawal),lastDayForEnrollmentOptionChange:s(u.lastDayForEnrollmentOptionChange),firstDayForFinalGrading:s(u.firstDayForFinalGrading),lastDayForFinalGrading:s(u.lastDayForFinalGrading),sessionBreak1BeginDate:s(e[f.Sess1Start]),sessionBreak1EndDate:s(e[f.Sess1End]),sessionBreak2BeginDate:s(e[f.Sess2Start]),sessionBreak2EndDate:s(e[f.Sess2End])};n.spinningWheel.center().open();r.save(o,function(){n.updateRequest("A","Approved");alert("Session Request Approved!");n.spinningWheel.center().close()},function(){alert("Failed to write the approved session "+o.academicTerm+"-"+o.sessionCode+" because it already exists in SIS.");n.spinningWheel.center().close()});return};n.updateRequest=function(t,r){if(!r){alert("Please provide a reason for rejecting the request.");return}var u=new Date,f={submissionId:n.submID,faoAction:n.selectedSess.faoAction,faoActionDate:n.selectedSess.faoActionDate,faoActionReason:n.selectedSess.faoActionReason,rnrAction:t,rnrActionDate:u.toDateString(),rnrActionReason:r};n.spinningWheel.center().open();i.update({submissionId:n.submID},f).$promise.then(function(){h(t)},function(n){alert("Update failed: "+n)})};$(document).ready(function(){n.spinningWheel.center().open();n.rates=f.query()})}]);