"use strict";function GetCampusLocation(n,t){for(var r="",i=0;i<t.length;++i)if(t[i].campusCode==n){r=t[i].campusName;break}return r}var adminModule=angular.module("adminModule",["ngResource","kendo.directives"]),sessionModule=angular.module("sessionModule",["ngResource","ngRoute","kendo.directives"]);sessionModule.config(["$routeProvider","$locationProvider",function(n,t){n.when("/",{templateUrl:"scripts/app/views/SessionRequest.html",controller:"sessionRequestCtrl"}).when("/Result",{templateUrl:"scripts/app/views/SessionResult.html",controller:"sessionResultCtrl"}).otherwise({redirectTo:"/"});t.html5Mode(!0)}]);sessionModule.factory("Get001Dates",["$resource",function(n){return n("api/sessions/:semester/001",{semester:"@id"})}]);sessionModule.factory("SemStartDates",["$resource",function(){var i=new Date,n=i.getFullYear(),t=parseInt(n)+1,f={spring:new Date("01/01/"+n),summer:new Date("05/01/"+n),fall:new Date("08/01/"+n)},o=f.spring,e=f.summer,s=f.fall,r=[],u=null;return i>=o&&i<e?(u=o,r=[{semName:n+" Spring",semCode:n+"1"},{semName:n+" Summer",semCode:n+"2"},{semName:n+" Fall",semCode:n+"3"},{semName:t+" Spring",semCode:t+"1"}]):i>=e&&i<s?(u=e,r=[{semName:n+" Summer",semCode:n+"2"},{semName:n+" Fall",semCode:n+"3"},{semName:t+" Spring",semCode:t+"1"},{semName:t+" Summer",semCode:t+"2"}]):(u=s,r=[{semName:n+" Fall",semCode:n+"3"},{semName:t+" Spring",semCode:t+"1"},{semName:t+" Summer",semCode:t+"2"},{semName:t+" Fall",semCode:t+"3"}]),{sStart:u,sChoices:r}}]);sessionModule.factory("SessionCodes",["$resource",function(n){return n("api/sessioncodes")}]);sessionModule.factory("Sessions",["$resource",function(n){return n("api/sessionrequests/:requestId",{requestId:"@id"})}]);adminModule.factory("CampusLocations",["$resource",function(n){return n("api/usclocations")}]);sessionModule.factory("CampusLocations",["$resource",function(n){return n("api/usclocations")}]);sessionModule.factory("GetCampusName",[function(){return function(n,t){return GetCampusLocation(n,t)}}]);adminModule.factory("GetCampusName",[function(){return function(n,t){return GetCampusLocation(n,t)}}]);adminModule.factory("RateTable",["$resource",function(n){return n("api/ratetable")}]);sessionModule.factory("RateTable",["$resource",function(n){return n("api/ratetable")}]);sessionModule.controller("indexCtrl",["$scope","$q",function(n){var t=function(){n.notifyOptions={autoHideAfter:7e3,templates:[{type:"error",template:$("#errorTemplate").html()},{type:"info",template:$("#infoTemplate").html()},{type:"warning",template:$("#warningTemplate").html()},{type:"success",template:$("#successTemplate").html()}]};n.showNotification=function(t,i){n.winNotification.show({title:t.charAt(0).toUpperCase()+t.slice(1),message:i},t)}};t()}]);sessionModule.controller("sessionRequestCtrl",["RateTable","Sessions","Get001Dates","SessionCodes","CampusLocations","SemStartDates","$scope","$http","$location","$rootScope",function(n,t,i,r,u,f,e,o,s,h){function p(n){var t="",i={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6};do{switch(n.getDay()){case i.Sunday:n.setDate(n.getDate()+1);break;case i.Saturday:n.setDate(n.getDate()+2)}t=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();l.indexOf(t)>-1&&(n.setDate(n.getDate()+1),t=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear())}while(n.getDay()==0||n.getDay()==6||l.indexOf(t)>-1);return n}function a(n,t,i){var f=Date.dateDiff("d",n,t)+1,e=Math.round(f*(i/100)),u=new Date(n),r;return u.setDate(n.getDate()+e-1),r=p(u),r>t&&(r=t),r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear()}function c(n){var i="",t;return n&&(t=new Date(n.trim()),i=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()),i}function v(n,t){e.session.lastDayForAddDrop=a(n,t,20);e.session.lastDayForEnrollmentOptionChange=a(n,t,40);e.session.lastDayForWithdrawal=a(n,t,80);return}function w(){var i=new Date,n=i.getFullYear(),t=parseInt(n)+1,f=new Date("01/01/"+n),r=new Date("05/01/"+n),o=new Date("08/01/"+n),u=[];u=i>=f&&i<r?[{semName:n+" Spring",semCode:n+"1"},{semName:n+" Summer",semCode:n+"2"},{semName:n+" Fall",semCode:n+"3"},{semName:t+" Spring",semCode:t+"1"}]:i>=r&&i<o?[{semName:n+" Summer",semCode:n+"2"},{semName:n+" Fall",semCode:n+"3"},{semName:t+" Spring",semCode:t+"1"},{semName:t+" Summer",semCode:t+"2"}]:[{semName:n+" Fall",semCode:n+"3"},{semName:t+" Spring",semCode:t+"1"},{semName:t+" Summer",semCode:t+"2"},{semName:t+" Fall",semCode:t+"3"}];e.semesters=u}function b(){var n=!0;switch(e.session.isClassHeldAtUpc){case"true":break;case"false":e.requireUSCLoc=!1;e.requireOtherLoc=!1;e.session.uscCampusLocation==""?(n=!1,e.requireUSCLoc=!0):e.session.uscCampusLocation=="OTH"&&e.session.otherCampusLocation==""&&(n=!1,e.requireOtherLoc=!0);break;default:n=!1}return n}function k(){var n=!0,t="";if((e.session.rateType=="OTH"||e.session.rateType=="OTHU")&&(parseInt(e.session.ratePerUnitAmount)>0||(t="The Tuition per Unit must have an amount greater than zero.",n=!1),n&&e.session.rateType=="OTH"))switch(!0){case!(parseInt(e.session.flatRateAmount)>0):t="The Tuition Flat Rate amount must have an amount greater than zero.";n=!1;break;case parseInt(e.session.ratePerUnitAmount)>=parseInt(e.session.flatRateAmount):t="The Tuition Flat Rate must be greater than the Tuition per Unit amount.";n=!1;e.ratesOK=!1;break;default:e.ratesOK=!0}if(e.session.flatRateAmount>"")switch(!0){case typeof e.session.flatRateUnitsMin=="undefined":case!(parseInt(e.session.flatRateUnitsMin)>0):t="The Flat Rate Range minimum units should be between 1 and "+(e.MAXUNITS-1)+".";e.requireUnitRange=!0;n=!1;break;case typeof e.session.flatRateUnitsMax=="undefined":case!(parseInt(e.session.flatRateUnitsMax)>1):t="The Flat Rate Range maximum units should be between 2 and "+e.MAXUNITS+".";e.requireUnitRange=!0;n=!1;break;case parseInt(e.session.flatRateUnitsMax)<=parseInt(e.session.flatRateUnitsMin):t="The flat rate maximum units should be more than the minimum units.";e.requireUnitRange=!0;n=!1;break;default:e.requireUnitRange=!1}return t>""&&alert(t),n}function d(){var i=!0,t="",n;if(e.requireBreaks=!1,!e.noBreaks)if(e.session.sessionBreaks.length==0)t="Either check the No Breaks checkbox or enter Session Breaks",i=!1,e.requireBreaks=!0;else for(n=0;n<e.session.sessionBreaks.length;++n)(e.session.sessionBreaks[n].startDate==""||e.session.sessionBreaks[n].endDate=="")&&(t="Either enter Session Breaks or check the No Breaks checkbox.",i=!1,e.requireBreaks=!0);return t>""&&alert(t),i}function g(){for(var n=!0,i=[e.session.academicTerm,e.sessCode.value(),e.session.firstDayOfClass,e.session.lastDayOfClass,e.session.firstDayOfFinals,e.session.lastDayOfFinals],t=0;t<i.length;++t)if(i[t].length==0){n=!1;break}return n&&(n=b()),n&&(n=k()),n&&(n=d()),n}function nt(){e.rates=n.query();return}e.MAXUNITS=40;e.AddSemesterBreaks=function(){e.session.sessionBreaks.length==2?alert("A maximum of 2 semester breaks are allowed per session."):e.session.sessionBreaks.push({startDate:"",endDate:""});return};Date.dateDiff=function(n,t,i){n=n.toLowerCase();var r=i-t;return Math.floor(r/{w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3}[n])};e.ClassDatesChanged=function(){var t,n,i,r;if(e.classStartDt=new Date(e.session.firstDayOfClass),e.session.firstDayOfClass>""){if(t=new Date(e.session.firstDayOfClass),t<y){alert("Class Start Date is an invalid date.");e.session.firstDayOfClass="";return}e.classEndOptions={min:e.classStartDt}}if(e.session.lastDayOfClass>""){if(n=new Date(e.session.lastDayOfClass),n<t){alert("Class End Date cannot be earlier than the Class Start Date.");e.session.lastDayOfClass="";return}e.finalsStartOptions={min:n}}return e.session.firstDayOfClass>""&&e.session.lastDayOfClass>""&&(e.sess001Dates.firstDayOfClass>""&&e.sess001Dates.lastDayOfClass>""?(i=new Date(e.sess001Dates.firstDayOfClass),r=new Date(e.sess001Dates.lastDayOfClass),e.classStartDt.toDateString()==i.toDateString()&&n.toDateString()==r.toDateString()?(e.session.lastDayForAddDrop=e.sess001Dates.lastDayForAddDrop,e.session.lastDayForEnrollmentOptionChange=e.sess001Dates.lastDayForEnrollmentOptionChange,e.session.lastDayForWithdrawal=e.sess001Dates.lastDayForWithdrawal,e.session.firstDayOfFinals=e.sess001Dates.firstDayOfFinals,e.session.lastDayOfFinals=e.sess001Dates.lastDayOfFinals,e.FinalsDatesChanged()):v(e.classStartDt,n)):v(e.classStartDt,n)),null};e.FinalsDatesChanged=function(){var t,o,r,f,i;if(e.session.firstDayOfFinals>""){if(t=new Date(e.session.firstDayOfFinals),o=new Date(e.session.lastDayOfClass),t<o){alert("Finals Start Date cannot be earlier than the Class End Date.");e.session.firstDayOfFinals="";return}e.finalsEndOptions={min:t}}if(e.session.lastDayOfFinals>""&&(r=new Date(e.session.lastDayOfFinals),r<t)){alert("Finals End Date cannot be earlier than the Finals Start Date.");e.session.lastDayOfFinals="";return}if(e.session.firstDayOfFinals>""&&e.session.lastDayOfFinals>""){e.session.firstDayForFinalGrading=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear();var n=new Date(r),u=!1,s="";for(f=0;f<4;++f){u=!1;do n.setDate(n.getDate()+1),s=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear(),u=n.getDay()==0||n.getDay()==6||l.indexOf(s)>-1?!0:!1;while(u)}i=n;e.session.lastDayForFinalGrading=i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()}};e.AddSection=function(){e.session.sections.push({sectionNumber:"",prefix:"",title:"",courseNumber:"",unitValue:0,instructorName:"",estimatedEnrollment:0,incomeAccountNumber:"",comments:"",schedules:[]});return};e.AddSchedule=function(n){n.schedules.push({classDayOfWeek:"",classStartTime:"",classEndTime:""});return};e.GetDatesAndRates=function(){function n(n,t){for(var r=!1,u=[],i=0;i<n.length;++i)n[i].term==t&&(r=!0,u=n[i]);return r?u.termRates.map(function(n){return{rateCode:n.rateTypeCode,rateName:n.rateTypeDesc}}):[]}i.get({semester:e.session.academicTerm},function(n){n.classBeginDate==undefined?alert("No Session 001 dates found for semester "+e.session.academicTerm):(e.sess001Dates.firstDayOfClass=c(n.classBeginDate),e.sess001Dates.lastDayOfClass=c(n.classEndDate),e.sess001Dates.lastDayForAddDrop=c(n.lastAddDropDate),e.sess001Dates.lastDayForWithdrawal=c(n.withdrawWithWDate),e.sess001Dates.lastDayForEnrollmentOptionChange=c(n.lastEnrollmentOptionDate),e.sess001Dates.sessBreak1Begin=c(n.break1BeginDate),e.sess001Dates.sessBreak1End=c(n.break1EndDate),e.sess001Dates.sessBreak2Begin=c(n.break2BeginDate),e.sess001Dates.sessBreak2End=c(n.break2EndDate),e.sess001Dates.firstDayOfFinals=c(n.finalExamBeginDate),e.sess001Dates.lastDayOfFinals=c(n.finalExamEndDate))},function(){console.log("No Session 001 dates found for semester "+e.session.academicTerm);e.sess001Dates.firstDayOfClass="";e.sess001Dates.lastDayOfClass="";e.sess001Dates.lastDayForAddDrop="";e.sess001Dates.lastDayForWithdrawal="";e.sess001Dates.lastDayForEnrollmentOptionChange="";e.sess001Dates.firstDayForFinalGrading="";e.sess001Dates.lastDayForFinalGrading="";e.sess001Dates.sessBreak1Begin="";e.sess001Dates.sessBreak1End="";e.sess001Dates.sessBreak2Begin="";e.sess001Dates.sessBreak2End="";e.sess001Dates.firstDayOfFinals="";e.sess001Dates.lastDayOfFinals=""});e.rateTypes=n(e.rates,e.session.academicTerm);e.rateTypes.push({rateCode:"OTHU",rateName:"Other Unit Rate"},{rateCode:"OTH",rateName:"Other Flat Rate"});e.session.rateType>""&&e.SetRates();return};e.SetRates=function(){if(e.session.rateType=="ZERO"?(e.session.flatRateUnitsMin=98,e.session.flatRateUnitsMax=99,$("#flatUnitsMin").prop("readonly",!0),$("#flatUnitsMax").prop("readonly",!0)):(e.session.flatRateUnitsMin="",e.session.flatRateUnitsMax="",$("#flatUnitsMin").prop("readonly",!1),$("#flatUnitsMax").prop("readonly",!1)),e.session.flatRateAmount="",e.session.ratePerUnitAmount="",e.unitRateRequired=!1,e.session.academicTerm>"")switch(e.session.rateType){case"OTH":e.unitRateRequired=!0;e.flatRateRequired=!0;e.session.flatRateUnitsMin="";e.session.flatRateUnitsMax="";break;case"OTHU":e.unitRateRequired=!0;e.flatRateRequired=!1;e.session.flatRateUnitsMin=98;e.session.flatRateUnitsMax=99;break;default:e.unitRateRequired=!1;e.flatRateRequired=!1;angular.forEach(e.rates,function(n){n.term==e.session.academicTerm&&angular.forEach(n.termRates,function(n){if(n.rateTypeCode==e.session.rateType){n.rateTypeUnitRate==""&&n.rateTypeFlatRate==""?(e.session.ratePerUnitAmount="TBA",e.session.flatRateAmount="TBA",e.MAXUNITS=99):(e.session.ratePerUnitAmount=n.rateTypeUnitRate,e.session.flatRateAmount=n.rateTypeFlatRate,e.MAXUNITS=40);switch(!0){case e.session.ratePerUnitAmount=="TBA"&&e.session.flatRateAmount=="TBA":e.session.flatRateUnitsMin="";e.session.flatRateUnitsMax="";break;case n.rateTypeCode=="ZERO":case n.rateTypeFlatRate=="":e.session.flatRateUnitsMin=98;e.session.flatRateUnitsMax=99;break;default:e.session.flatRateUnitsMin="";e.session.flatRateUnitsMax=""}}})})}return};e.checkSessBreak=function(n){var r=e.session.sessionBreaks[n].startDate,t="",i,u,f;r>""&&(i=new Date(r),i<y?(t="Entered date is from a previous semester.",e.session.sessionBreaks[n].startDate=""):(u=e.session.sessionBreaks[n].endDate,f=new Date(u),i>f&&(t="Entered Session Begin Date is later than Session End Date.",e.session.sessionBreaks[n].endDate="")));t>""&&alert(t);return};e.deleteBreaks=function(){e.noBreaks&&(e.session.sessionBreaks=[]);return};e.BlankOtherLocation=function(){e.session.uscCampusLocation!="OTH"&&e.session.otherCampusLocation>""&&(e.session.otherCampusLocation="");return};e.SubmitForm=function(){var i,r,n;if(!g()){alert("Please provide required fields.");return}for(i=new Date,e.session.submitDate=i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear(),r=e.sessCode.value().trim(),e.session.sessionCode=r.substring(0,3),e.session.sessionName=r.substring(3),e.session.sessionName=e.session.sessionName.trim(),h.rateName="",n=0;n<e.rateTypes.length;++n)if(e.rateTypes[n].rateCode==e.session.rateType){h.rateName=e.rateTypes[n].rateName;break}e.session.ratePerUnitAmount=="TBA"&&e.session.flatRateAmount=="TBA"&&(e.session.ratePerUnitAmount=null,e.session.flatRateAmount=null);h.savedSession=new t(e.session);e.spinningWheel.center().open();h.savedSession.$save(null,function(){alert("Submission successful");e.spinningWheel.center().close();s.url("/Result")},function(){alert("Error in submitting the form.");e.spinningWheel.center().close()});return};e.rates=[];e.CheckRateAmount=function(n,t){if(e.session.rateType=="OTH"&&n<1&&alert("Please enter an amount greater than 0 in the "+t+" box."),n<1)alert("Please enter a "+t+" that is greater than 0.");else{var i=parseInt(e.session.flatRateAmount),r=parseInt(e.session.ratePerUnitAmount);i>0&&r>0&&r>i&&(alert("The Tuition Unit Rate amount cannot be higher than the Tuition Flat Rate amount."),e.ratesOK=!1)}};var l=[],y=new Date(f.sStart);$(document).ready(function(){r.get(function(n){var r=[],i=n.sessionCodes,t;if(i!=null)for(t=0;t<i.length;++t)r[t]=i[t].sessionCode+"  "+i[t].sessionDesc;e.sessionCodes=r});w();e.earliestDate=f.sStart;nt();e.campusLocs=u.query(function(){e.campusLocs.push({campusCode:"OTH",campusName:"Other Location"})});l=["1/2/2017","1/16/2017","2/20/2017","5/29/2017","7/3/2017","7/4/2017","9/14/2017","11/23/2017","11/24/2017","11/24/2017","12/25/2017","12/26/2017","12/27/2017","12/28/2017","12/29/2017","1/1/2018","1/15/2018","2/19/2018","5/28/2018","7/4/2018","9/3/2018","11/22/2018","11/23/2018","12/24/2018","12/25/2018","12/25/2018","12/26/2018","12/27/2018","12/28/2018","12/29/2018","12/30/2017","12/31/2018","1/1/2019","1/21/2019","2/18/2019","5/27/2019","7/4/2019","7/5/2019","9/2/2019","11/28/2019","11/29/2019","12/25/2019","12/26/2019","12/27/2019","12/28/2019","12/29/2019","12/30/2019","12/31/2019","1/1/2020","1/20/2020","2/17/2020","5/25/2020","7/3/2020","9/7/2020","11/26/2020","11/27/2020","12/25/2020","12/28/2020","12/29/2020","12/30/2020","12/31/2020"];e.session={academicTerm:"",sessionCode:"",sessionName:"",owningSchool:"",owningDepartment:"",userContact:"",userEmail:"",userPhone:"",firstDayOfClass:"",lastDayOfClass:"",lastDayForAddDrop:"",lastDayForEnrollmentOptionChange:"",lastDayForWithdrawal:"",firstDayOfFinals:"",firstDayForFinalGrading:"",lastDayForFinalGrading:"",isClassHeldAtUpc:null,uscCampusLocation:"",otherCampusLocation:"",rateType:"",ratePerUnitAmount:"",flatRateAmount:"",flatRateUnitsMin:"",flatRateUnitsMax:"",comments:"",sessionBreaks:[],sections:[],submitDate:""};e.sess001Dates={firstDayOfClass:"",lastDayOfClass:"",lastDayForAddDrop:"",lastDayForWithdrawal:"",lastDayForEnrollmentOptionChange:"",firstDayForFinalGrading:"",lastDayForFinalGrading:"",sessBreak1Begin:"",sessBreak1End:"",sessBreak2Begin:"",sessBreak2End:""};e.requireUSCLoc=!1;e.requireOtherLoc=!1;e.requireUnitRange=!1;e.ratesOK=!0})}]);sessionModule.controller("sessionResultCtrl",["Sessions","GetCampusName","CampusLocations","$scope","$location","$rootScope",function(n,t,i,r,u,f){r.session=f.savedSession;r.rateName=f.rateName;var e=r.session.sessionBreaks;switch(e.length){case 2:r.session.sessionBreakStart_2=e[1].startDate;r.session.sessionBreakEnd_2=e[1].endDate;case 1:r.session.sessionBreakStart_1=e[0].startDate;r.session.sessionBreakEnd_1=e[0].endDate;break;default:r.session.sessionBreakStart_2="";r.session.sessionBreakEnd_2=""}f.savedSession.ratePerUnitAmount==null&&f.savedSession.flatRateAmount==null&&(r.session.ratePerUnitAmount="TBA",r.session.flatRateAmount="TBA");i.query(function(n){r.campusDescription=t(r.session.uscCampusLocation,n)})}]);